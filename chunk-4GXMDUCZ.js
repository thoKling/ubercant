import{$b as ue,Aa as P,Ac as ce,Ea as J,Eb as $,Ec as fe,Gb as _,Hb as B,Qb as se,Ua as U,Wb as le,ba as ee,ca as te,d as _e,e as qe,eb as H,fb as ie,ga as ne,jb as ae,pa as re,qa as L,qb as oe,ra as z,yb as x,zb as A}from"./chunk-DCBKB7PE.js";var de=_e((G,X)=>{"use strict";(function(s,g){typeof G=="object"&&typeof X<"u"?X.exports=g():typeof define=="function"&&define.amd?define(g):(s=typeof globalThis<"u"?globalThis:s||self).ImageKit=g()})(G,function(){"use strict";function s(n){return(s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}function g(n,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function e(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}function r(n,t){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable})),a.push.apply(a,i)}return a}function o(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?r(Object(a),!0).forEach(function(i){e(n,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(a,i))})}return n}function f(n,t){(t==null||t>n.length)&&(t=n.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=n[a];return i}function h(n,t){var a;if(typeof Symbol>"u"||n[Symbol.iterator]==null){if(Array.isArray(n)||(a=function(l,I){if(l){if(typeof l=="string")return f(l,I);var v=Object.prototype.toString.call(l).slice(8,-1);return v==="Object"&&l.constructor&&(v=l.constructor.name),v==="Map"||v==="Set"?Array.from(l):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?f(l,I):void 0}}(n))||t&&n&&typeof n.length=="number"){a&&(n=a);var i=0,d=function(){};return{s:d,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(l){throw l},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p,c=!0,u=!1;return{s:function(){a=n[Symbol.iterator]()},n:function(){var l=a.next();return c=l.done,l},e:function(l){u=!0,p=l},f:function(){try{c||a.return==null||a.return()}finally{if(u)throw p}}}}var k={message:"Missing urlEndpoint during SDK initialization",help:""},E={message:"Invalid transformationPosition parameter",help:""},O={message:"Missing file parameter for upload",help:""},T={message:"Missing fileName parameter for upload",help:""},N={message:"Missing public key for upload",help:""},R={message:"Request to ImageKit upload endpoint failed due to network error",help:""},he={message:"Invalid uploadOptions parameter",help:""},me={message:"Missing signature for upload. The SDK expects token, signature and expire for authentication.",help:""},ge={message:"Missing token for upload. The SDK expects token, signature and expire for authentication.",help:""},ve={message:"Missing expire for upload. The SDK expects token, signature and expire for authentication.",help:""},ye={message:"Invalid transformation parameter. Please include at least pre, post, or both.",help:""},be={message:"Invalid pre transformation parameter.",help:""},V={message:"Invalid post transformation parameter.",help:""};function b(n,t,a){typeof a=="function"&&(n?a(t,null):a(null,t))}function we(n){var t={},a=n.getAllResponseHeaders();return Object.keys(a).length&&a.trim().split(/[\r\n]+/).map(function(i){return i.split(/: /)}).forEach(function(i){t[i[0].trim()]=i[1].trim()}),t}var Q=function(n,t){var a=o({},n),i={statusCode:t.status,headers:we(t)};return Object.defineProperty(a,"$ResponseMetadata",{value:i,enumerable:!1,writable:!1}),a},ke=function(n,t){return new Promise(function(a,i){n.open("POST","https://upload.imagekit.io/api/v1/files/upload"),n.onerror=function(d){return i(R)},n.onload=function(){if(n.status===200)try{var d=JSON.parse(n.responseText),p=Q(d,n);return a(p)}catch(u){return i(u)}else try{d=JSON.parse(n.responseText);var c=Q(d,n);return i(c)}catch(u){return i(u)}},n.send(t)})},Ie=function(n,t,a,i){if(t.file)if(t.fileName)if(a.publicKey)if(t.token)if(t.signature)if(t.expire){if(t.transformation){if(!Object.keys(t.transformation).includes("pre")&&!Object.keys(t.transformation).includes("post"))return void b(!0,ye,i);if(Object.keys(t.transformation).includes("pre")&&!t.transformation.pre)return void b(!0,be,i);if(Object.keys(t.transformation).includes("post")){if(!Array.isArray(t.transformation.post))return void b(!0,V,i);var d,p=h(t.transformation.post);try{for(p.s();!(d=p.n()).done;){var c=d.value;if(c.type==="abs"&&!c.protocol&&!c.value||c.type==="transformation"&&!c.value)return void b(!0,V,i)}}catch(I){p.e(I)}finally{p.f()}}}var u,l=new FormData;for(u in t)u&&(u==="file"&&typeof t.file!="string"?l.append("file",t.file,String(t.fileName)):u==="tags"&&Array.isArray(t.tags)?l.append("tags",t.tags.join(",")):u==="signature"?l.append("signature",t.signature):u==="expire"?l.append("expire",String(t.expire)):u==="token"?l.append("token",t.token):u==="responseFields"&&Array.isArray(t.responseFields)?l.append("responseFields",t.responseFields.join(",")):u==="extensions"&&Array.isArray(t.extensions)?l.append("extensions",JSON.stringify(t.extensions)):u!=="customMetadata"||s(t.customMetadata)!=="object"||Array.isArray(t.customMetadata)||t.customMetadata===null?u==="transformation"&&s(t.transformation)==="object"&&t.transformation!==null?l.append(u,JSON.stringify(t.transformation)):u==="checks"&&t.checks?l.append("checks",t.checks):t[u]!==void 0&&l.append(u,String(t[u])):l.append("customMetadata",JSON.stringify(t.customMetadata)));l.append("publicKey",a.publicKey),function(I,v,m){ke(I,v).then(function(w){return b(!1,w,m)},function(w){return b(!0,w,m)})}(n,l,i)}else b(!0,ve,i);else b(!0,me,i);else b(!0,ge,i);else b(!0,N,i);else b(!0,T,i);else b(!0,O,i)},W={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",effectShadow:"e-shadow",effectGradient:"e-gradient",raw:"raw"},Ee=["path","query"],Oe=function(){return"path"},je=function(n){return n.transformationPosition==="query"},Pe=function(n){return n.transformationPosition!==void 0&&Ee.indexOf(n.transformationPosition)!=-1},Ue=function(n){return n&&(W[n]||W[n.toLowerCase()])||""},Y=function(){return":"},Me=function(){return","},Se=function(){return"-"};function Ce(n){return typeof n=="string"&&n[n.length-1]=="/"&&(n=n.substring(0,n.length-1)),n}function D(n,t){var a=t||"/",i=new RegExp(a+"{1,}","g");return n.join(a).replace(i,a)}var Fe=function(n){if(!n.path&&!n.src)return"";var t,a,i;try{n.path?(i=new URL(n.urlEndpoint).pathname,t=new URL(D([n.urlEndpoint.replace(i,""),n.path]))):(t=new URL(n.src),a=!0)}catch(c){return console.error(c),""}for(var d in n.queryParameters)t.searchParams.append(d,String(n.queryParameters[d]));var p=function(c){if(!Array.isArray(c))return"";for(var u=[],l=0,I=c.length;l<I;l++){var v=[];for(var m in c[l])if(c[l][m]!==void 0&&c[l][m]!==null){var w=Ue(m);if(w||(w=m),c[l][m]==="-")v.push(w);else if(m==="raw")v.push(c[l][m]);else{var j=c[l][m];w==="di"&&(j=(j=Ce((typeof(y=j||"")=="string"&&y[0]=="/"&&(y=y.slice(1)),y))).replace(/\//g,"@@")),v.push([w,j].join(Se()))}}u.push(v.join(Me()))}var y;return u.join(Y())}(n.transformation);return p&&p.length&&(je(n)||a?t.searchParams.append("tr",p):t.pathname=D(["tr"+Y()+p,t.pathname])),t.pathname=D(i?[i,t.pathname]:[t.pathname]),t.href};return function(){function n(d){if(function(p,c){if(!(p instanceof c))throw new TypeError("Cannot call a class as a function")}(this,n),e(this,"options",{sdkVersion:"javascript-".concat("3.0.2"),publicKey:"",urlEndpoint:"",transformationPosition:Oe()}),this.options=o(o({},this.options),d||{}),!this.options.urlEndpoint)throw k;if(!Pe(this.options))throw E}var t,a,i;return t=n,(a=[{key:"url",value:function(d){return p=d,c=this.options,Fe(o(o({},c),p));var p,c}},{key:"upload",value:function(d,p,c){var u;if(typeof p=="function"?u=p:c=p||{},!d||s(d)!=="object")return b(!0,he,u);var l=o(o({},this.options),c),I=(d||{}).xhr;delete d.xhr;var v,m,w=I||new XMLHttpRequest;return(v=this,m=Ie,function(){for(var j=arguments.length,y=new Array(j),S=0;S<j;S++)y[S]=arguments[S];if(y.length!==m.length||y[y.length-1]===void 0)return new Promise(function(xe,Ae){y.pop(),y.push(function(Z){if(Z)return Ae(Z);for(var K=arguments.length,C=new Array(K>1?K-1:0),F=1;F<K;F++)C[F-1]=arguments[F];xe(C.length>1?C:C[0])}),m.call.apply(m,[v].concat(y))});if(typeof y[y.length-1]!="function")throw new Error("Callback must be a function.");m.call.apply(m,[v].concat(y))})(w,d,l,u)}}])&&g(t.prototype,a),i&&g(t,i),n}()})});var pe=qe(de());function Te(s,g){if(s&1){let e=$();x(0,"input",2),_("change",function(o){L(e);let f=B();return z(f.handleFileInput(o))}),A()}}function Ne(s,g){if(s&1){let e=$();x(0,"input",3),_("change",function(o){L(e);let f=B();return z(f.handleFileInput(o))}),A()}}var Re="5.1.0",q=class{},M=(()=>{class s{constructor(e){this.configuration=e,e.sdkVersion=`angular-${Re}`,this._ikInstance=new pe.default(this.configuration)}get ikInstance(){return this._ikInstance}getUrl(e){return this._ikInstance.url(e)}}return s.\u0275fac=function(e){return new(e||s)(ne(q))},s.\u0275prov=ee({token:s,factory:s.\u0275fac}),s})(),Ye=(()=>{class s{constructor(e,r){this.el=e,this.imagekit=r,this.transformation=[],this.url="",this.lqipUrl="",this.onImageLoaded=o=>{let{loading:f,lqipUrl:h,url:k}=this;f!=="lazy"&&o.srcElement.src===h&&this.loadImage(this,k)}}ngOnInit(){let e=this.src?{src:this.src}:{path:this.path};e.urlEndpoint=this.urlEndpoint?this.urlEndpoint:this.imagekit._ikInstance.options.urlEndpoint,e.transformation=this.transformation,e.transformationPosition=this.transformationPosition,e.queryParameters=this.queryParameters,e.lqip=this.lqip,this.setUrl(e)}ngOnChanges(){this.ngOnInit(),this.ngAfterViewInit()}ngAfterViewInit(){if(this.loading=="lazy"){let e=this;this.lqipUrl&&this.loadImage(this,this.lqipUrl),new IntersectionObserver((o,f)=>{e.handleIntersectionObserver(o,f,e.loadImage,e,e.url)}).observe(this.el.nativeElement)}else this.loadImage(this,this.lqipUrl?this.lqipUrl:this.url)}handleIntersectionObserver(e,r,o,f,h){if(e[0]&&e[0].isIntersecting){let k=e[0].target;o(f,h),r.unobserve(k)}}setUrl(e){let r=this.getConfigObject(e);this.url=this.imagekit.getUrl(r),e.lqip&&e.lqip.active===!0&&(this.lqipUrl=this.constructLqipUrl(e,e.lqip))}constructLqipUrl(e,r){if(r&&r.active){var o=Math.round(r.quality||r.threshold||20),f=Math.round(r.blur||6),h=e.transformation?[...e.transformation]:[];return r.raw&&typeof r.raw=="string"&&r.raw.trim()!=""?h.push({raw:r.raw.trim()}):h.push({quality:String(o),blur:String(f)}),this.imagekit.ikInstance.url(Object.assign(Object.assign({},e),{transformation:h}))}}getConfigObject(e){let r={transformation:e.transformation};if(e.urlEndpoint)r.urlEndpoint=e.urlEndpoint;else throw new Error("Missing urlEndpoint initialization!");if(e.queryParameters&&(r.queryParameters=e.queryParameters),e.src)r.src=e.src,r.transformationPosition="query";else if(e.path)r.path=e.path,e.transformationPosition&&(r.transformationPosition=e.transformationPosition);else throw new Error("Missing src / path during initialization!");return r}loadImage(e,r){let o=e.el.nativeElement,f=o.attributes,h=e.namedNodeMapToObject(f);h.src=r;let k=o.children[0];e.setElementAttributes(k,h)}namedNodeMapToObject(e){let r={};return Object.keys(e).forEach(o=>{let f=e[o].name,h=e[o].value;r[f]=h}),r}setElementAttributes(e,r){Object.keys(r).filter(o=>o!=="loading").forEach(o=>{e.setAttribute(o,r[o])})}}return s.\u0275fac=function(e){return new(e||s)(U(J),U(M))},s.\u0275cmp=H({type:s,selectors:[["ik-image"]],inputs:{src:"src",path:"path",urlEndpoint:"urlEndpoint",transformation:"transformation",transformationPosition:"transformationPosition",queryParameters:"queryParameters",lqip:"lqip",loading:"loading"},standalone:!1,features:[re],decls:1,vars:0,consts:[["src","",3,"load"]],template:function(e,r){e&1&&(x(0,"img",0),_("load",function(f){return r.onImageLoaded(f)}),A())},encapsulation:2}),s})();var Ze=(()=>{class s{constructor(e,r){this.el=e,this.imagekit=r,this.onError=new P,this.onSuccess=new P,this.fileToUpload=null,this.handleAuthResponse=({signature:o,token:f,expire:h},k,E,O,T)=>{k.upload(Object.assign(Object.assign({},E),{signature:o,token:f,expire:h}),(N,R)=>{this.handleUploadResponse(N,R,O,T)})}}ngAfterViewInit(){this.buttonRef&&this.buttonRef.addEventListener("click",()=>{this.el.nativeElement.children[0].click()})}abort(){this.xhr&&this.xhr.abort()}handleFileInput(e){let r=e.target.files;this.fileToUpload=r.item(0);let o={file:this.fileToUpload,fileName:this.fileName||this.fileToUpload.name,useUniqueFileName:this.useUniqueFileName,tags:this.tags,folder:this.folder,customMetadata:this.customMetadata,isPrivateFile:this.isPrivateFile,overwriteFile:this.overwriteFile,overwriteAITags:this.overwriteAITags,overwriteTags:this.overwriteTags,overwriteCustomMetadata:this.overwriteCustomMetadata,customCoordinates:this.customCoordinates,responseFields:this.responseFields,extensions:this.extensions,webhookUrl:this.webhookUrl,onError:this.onError,onSuccess:this.onSuccess,transformation:this.transformation,checks:this.checks};this.checkCustomFileValidation(o.file)&&this.checkAuthenticator(o)&&this.startIkUpload(e,o)}checkCustomFileValidation(e){return this.validateFile&&typeof this.validateFile=="function"?this.validateFile(e):!0}checkAuthenticator(e){return!this.authenticator||typeof this.authenticator!="function"||this.authenticator.length!==0||!(this.authenticator()instanceof Promise)?this.throwError("The authenticator function is not provided or is not a function.",e):!0}throwError(e,r){return r&&r.onError instanceof P&&r.onError.emit({message:e||"Something went wrong."}),!1}startIkUpload(e,r){this.onUploadStart&&typeof this.onUploadStart=="function"&&this.onUploadStart(e),r.xhr=new XMLHttpRequest,this.xhr=r.xhr;let o=this.getUploadParams(r),f=this.createUploadProgressMonitor(r.xhr),h=this.getIkInstance();this.authenticator().then(E=>this.handleAuthResponse(E,h,o,r,f)).catch(E=>{var O;E instanceof Array?O=E[0]:O=E,this.throwError(String(O),r)})}getIkInstance(){return this.publicKey===void 0||this.urlEndpoint===void 0?this.imagekit.ikInstance:new M({urlEndpoint:this.urlEndpoint,publicKey:this.publicKey})._ikInstance}handleUploadResponse(e,r,o,f){e?this.throwError(e,o):(o.onSuccess instanceof P&&o.onSuccess.emit(r),o.xhr&&o.xhr.upload.removeEventListener("progress",f))}createUploadProgressMonitor(e){let r=o=>{this.onUploadProgress&&typeof this.onUploadProgress=="function"&&this.onUploadProgress(o)};return e&&e.upload.addEventListener("progress",r),r}getUploadParams(e){let r={file:e.file,fileName:e.fileName};return e.useUniqueFileName!==void 0&&Object.assign(r,{useUniqueFileName:e.useUniqueFileName}),e.folder!==void 0&&Object.assign(r,{folder:e.folder}),e.customMetadata!==void 0&&Object.assign(r,{customMetadata:e.customMetadata}),e.webhookUrl!==void 0&&Object.assign(r,{webhookUrl:e.webhookUrl}),e.isPrivateFile!==void 0&&Object.assign(r,{isPrivateFile:e.isPrivateFile}),e.overwriteFile!==void 0&&Object.assign(r,{overwriteFile:e.overwriteFile}),e.overwriteAITags!==void 0&&Object.assign(r,{overwriteAITags:e.overwriteAITags}),e.overwriteTags!==void 0&&Object.assign(r,{overwriteTags:e.overwriteTags}),e.overwriteCustomMetadata!==void 0&&Object.assign(r,{overwriteCustomMetadata:e.overwriteCustomMetadata}),e.tags!==void 0&&Object.assign(r,{tags:e.tags}),e.customCoordinates!==void 0&&Object.assign(r,{customCoordinates:e.customCoordinates}),e.responseFields!==void 0&&Object.assign(r,{responseFields:e.responseFields}),e.extensions!==void 0&&Object.assign(r,{extensions:e.extensions}),e.xhr!==void 0&&Object.assign(r,{xhr:e.xhr}),e.transformation!==void 0&&Object.assign(r,{transformation:e.transformation}),e.checks!==void 0&&Object.assign(r,{checks:e.checks}),r}}return s.\u0275fac=function(e){return new(e||s)(U(J),U(M))},s.\u0275cmp=H({type:s,selectors:[["ik-upload"]],inputs:{fileName:"fileName",useUniqueFileName:"useUniqueFileName",tags:"tags",folder:"folder",publicKey:"publicKey",urlEndpoint:"urlEndpoint",authenticator:"authenticator",isPrivateFile:"isPrivateFile",overwriteFile:"overwriteFile",overwriteAITags:"overwriteAITags",overwriteTags:"overwriteTags",overwriteCustomMetadata:"overwriteCustomMetadata",customCoordinates:"customCoordinates",webhookUrl:"webhookUrl",responseFields:"responseFields",extensions:"extensions",customMetadata:"customMetadata",buttonRef:"buttonRef",validateFile:"validateFile",onUploadStart:"onUploadStart",onUploadProgress:"onUploadProgress",transformation:"transformation",checks:"checks"},outputs:{onError:"onError",onSuccess:"onSuccess"},standalone:!1,features:[le([M])],decls:3,vars:2,consts:[["elseBlock",""],["type","file","style","display:none",3,"change",4,"ngIf","ngIfElse"],["type","file",2,"display","none",3,"change"],["type","file",3,"change"]],template:function(e,r){if(e&1&&ae(0,Te,1,0,"input",1)(1,Ne,1,0,"ng-template",null,0,ue),e&2){let o=se(2);oe("ngIf",r.buttonRef)("ngIfElse",o)}},dependencies:[ce],encapsulation:2}),s})(),et=(()=>{class s{static forRoot(e){return{ngModule:s,providers:[{provide:q,useValue:e}]}}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=ie({type:s}),s.\u0275inj=te({providers:[M],imports:[[fe]]}),s})();export{Ye as a,Ze as b,et as c};
